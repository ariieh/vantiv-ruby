#!/usr/bin/env ruby

require "dotenv"
require "vantiv"
require "vantiv/mocked_sandbox/fixture_generator"

def environment_from_env
  env_map = [
    Vantiv::Environment::POSTCERTIFICATION,
    Vantiv::Environment::PRECERTIFICATION,
  ].map { |env| [env.to_s, env] }.to_h

  env_map.fetch(
    ENV["VANTIV_ENVIRONMENT"]&.downcase,
    Vantiv::Environment::PRECERTIFICATION
  )
end

Dotenv.load
Vantiv.configure do |config|

  config.environment = environment_from_env
  config.merchant_id = ENV["MERCHANT_ID"]
  config.default_order_source = "ecommerce"
  config.paypage_id = ENV["PAYPAGE_ID"]

  config.user = ENV["VANTIV_USER"]
  config.password = ENV["VANTIV_PASSWORD"]

  config.default_report_group = '1'
end

if File.directory? Vantiv::MockedSandbox.fixtures_directory
  FileUtils.rm_rf("#{Vantiv::MockedSandbox.fixtures_directory}/.", secure: true)
end
FileUtils.mkdir_p(Vantiv::MockedSandbox.fixtures_directory)

Vantiv::MockedSandbox::FixtureGenerator.generate_all
